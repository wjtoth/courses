\documentclass[letterpaper,12pt,oneside,onecolumn]{article}
\usepackage[margin=1in, bottom=1in, top=1in]{geometry} %1 inch margins
\usepackage{amsmath, amssymb, amstext}
\usepackage{fancyhdr}
\usepackage{mathtools}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{theorem}
\usepackage{tikz}
\usepackage{tkz-berge}
\usepackage[braket, qm]{qcircuit}
\usepackage{hyperref}

%Macros
\newcommand{\A}{\mathbb{A}} \newcommand{\C}{\mathbb{C}}
\newcommand{\D}{\mathbb{D}} \newcommand{\F}{\mathbb{F}}
\newcommand{\N}{\mathbb{N}} \newcommand{\R}{\mathbb{R}}
\newcommand{\T}{\mathbb{T}} \newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
 
 
\newcommand{\cA}{\mathcal{A}} \newcommand{\cB}{\mathcal{B}}
\newcommand{\cC}{\mathcal{C}} \newcommand{\cD}{\mathcal{D}}
\newcommand{\cE}{\mathcal{E}} \newcommand{\cF}{\mathcal{F}}
\newcommand{\cG}{\mathcal{G}} \newcommand{\cH}{\mathcal{H}}
\newcommand{\cI}{\mathcal{I}} \newcommand{\cJ}{\mathcal{J}}
\newcommand{\cK}{\mathcal{K}} \newcommand{\cL}{\mathcal{L}}
\newcommand{\cM}{\mathcal{M}} \newcommand{\cN}{\mathcal{N}}
\newcommand{\cO}{\mathcal{O}} \newcommand{\cP}{\mathcal{P}}
\newcommand{\cQ}{\mathcal{Q}} \newcommand{\cR}{\mathcal{R}}
\newcommand{\cS}{\mathcal{S}} \newcommand{\cT}{\mathcal{T}}
\newcommand{\cU}{\mathcal{U}} \newcommand{\cV}{\mathcal{V}}
\newcommand{\cW}{\mathcal{W}} \newcommand{\cX}{\mathcal{X}}
\newcommand{\cY}{\mathcal{Y}} \newcommand{\cZ}{\mathcal{Z}}

\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}


\newenvironment{proof}{{\bf Proof:  }}{\hfill\rule{2mm}{2mm}}
\newenvironment{proofof}[1]{{\bf Proof of #1:  }}{\hfill\rule{2mm}{2mm}}
\newenvironment{proofofnobox}[1]{{\bf#1:  }}{}\newenvironment{example}{{\bf Example:  }}{\hfill\rule{2mm}{2mm}}

%\renewcommand{\thesection}{\lecnum.\arabic{section}}
%\renewcommand{\theequation}{\thesection.\arabic{equation}}
%\renewcommand{\thefigure}{\thesection.\arabic{figure}}

\newtheorem{fact}{Fact}[section]
\newtheorem{lemma}[fact]{Lemma}
\newtheorem{theorem}[fact]{Theorem}
\newtheorem{definition}[fact]{Definition}
\newtheorem{corollary}[fact]{Corollary}
\newtheorem{proposition}[fact]{Proposition}
\newtheorem{claim}[fact]{Claim}
\newtheorem{exercise}[fact]{Exercise}
\newtheorem{note}[fact]{Note}
\newtheorem{conjecture}[fact]{Conjecture}

\newcommand{\size}[1]{\ensuremath{\left|#1\right|}}
\newcommand{\ceil}[1]{\ensuremath{\left\lceil#1\right\rceil}}
\newcommand{\floor}[1]{\ensuremath{\left\lfloor#1\right\rfloor}}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%

\DeclareMathOperator{\defi}{def}
%END MACROS
%Page style
\pagestyle{fancy}

\listfiles

\raggedbottom

\lhead{\today}
\rhead{W. Justin Toth - A4} %CHANGE n to ASSIGNMENT NUMBER ijk TO COURSE CODE
\renewcommand{\headrulewidth}{1pt} %heading underlined
%\renewcommand{\baselinestretch}{1.2} % 1.2 line spacing for legibility (optional)

\begin{document}
\section{}
\paragraph{}
Let $v(G)$ and $e(G)$ denote the number of vertices and edges respectively of a graph $G$. Also let $c(G)$ denote the number of connected components of $G$. Let $\phi$ be a $k$-coloring of $G$. Define $\cB(G, \phi)$ so that
$$\cB(G,\phi) = \{G[\phi^{-1}(c) \cup \phi^{-1}(c')] : c \in \{1,\dots, k\}, c'\in \{1,\dots, k\}\backslash\{c\}\}.$$
I.e. $\cB(G,\phi)$ is the set of bipartite subgraphs of $G$ induced by two distinct color classes under $\phi$.
\begin{lemma}\label{lemma:bipartite-cc}
For all $k \geq 3$, for all $k$-colorable graphs $G$, if $\phi$ is a $k$-coloring of $G$ then
$$\sum_{H \in \cB(G,\phi)} c(H) \geq (k-1)v(G) - e(G).$$
\end{lemma}
\begin{proof}
Fix $k \geq 3$ and fix $n \geq k$. Let $G$ be a graph with $v(G) = n$. We proceed by induction on $e(G)$. First suppose $e(G) = 0$. Let $\phi$ be a $k$-coloring of $G$. If $v \in V(G)$ then $v$ is assigned a color class $c$ and hence is a vertex of each graph $G[\phi^{-1}(c) \cup \phi^{-1}(c')]$ for $c' \neq c$. There are $k-1$ such graphs, and since $e(G) = 0$, $v$ itself is a unique connected component of each such graph. Therefore
$$\sum_{H \in \cB(G,\phi)} c(H)= \sum_{v \in V(G)} (k-1) = (k-1)v(G) - e(G).$$
Now suppose $e(G) >0$ and the lemma holds for $k$-colorable, $n$ vertex graphs with fewer than $e(G)$ edges. Again let $\phi$ be a $k$-coloring of $G$. Let $uv \in E(G)$. Let $c = \phi(u)$ and $c' = \phi(v)$. Let $H' := G[\phi^{-1}(c) \cup \phi^{-1}(c')]$. Then $H'$ is the unique graph in $\cB(G,\phi)$ containing edge $uv$. If $uv$ is a bridge of its connected component in $H'$ then $c(H'-uv) = c(H') + 1$, otherwise $c(H'-uv) = c(H')$. Hence $c(H'-uv) \leq c(H')+1$. So
\begin{align*}
\sum_{H \in \cB(G,\phi)} c(H) &= c(H') + \sum_{H \in \cB(G, \phi)\backslash\{H'\}} c(H)\\
&= c(H') +  \sum_{H \in \cB(G-uv, \phi)\backslash\{H'\}} c(H) &\text{(since $uv$ is only an edge of $H'$)}\\ 
&\geq c(H'-uv)-1 +  \sum_{H \in \cB(G-uv, \phi)\backslash\{H'\}} c(H)\\
&=  -1 + \sum_{H \in \cB(G-uv, \phi)} c(H)\\
&\geq - 1 + (k-1)v(G) - e(G) + 1 &\text{(by induction hypothesis on $G-uv$)}\\
&= (k-1)v(G) - e(G).
\end{align*}
Therefore by induction the lemma holds.
\end{proof}
\begin{lemma}
Let $k\geq 3$. If $G$ is a $k$-colorable graph then $G$ has at least $2^{\frac{(k-1)v(G) - e(G)}{{k \choose 2}}}$ distinct $k$-colorings.
\end{lemma}
\begin{proof}
Let $\phi$ be a $k$-coloring of $G$. Let $H = G[\phi^{-1}(c) \cup \phi^{-1}(c')] \in \cB(G,\phi)$. We can obtain a distinct $k$-coloring of $G$ by choosing any number of connected components $H_1, \dots, H_k$ of $H$ and switching colors $c$ and $c'$ on the vertices of $H_1, \dots, H_k$. Thus in this manner we can obtain $2^{c(H)}$ distinct $k$-colorings of $G$. It will then suffice to show that there exists $H \in \cB(G,\phi)$ such that
$$c(H) \geq \frac{(k-1)v(G) - e(G)}{{k \choose 2}}.$$
Since there are ${k\choose 2}$ graphs in $\cB(G,\phi)$, by the pigeonhole principle, there exists $H' \in \cB(G,\phi)$ such that
$$c(H') \geq \frac{\sum_{H \in \cB(G,\phi)} c(H)}{{k\choose 2}}$$
Therefore by Lemma \ref{lemma:bipartite-cc} 
$$c(H') \geq \frac{(k-1)v(G) - e(G)}{{k\choose 2}}$$
as desired.
\end{proof}
\begin{corollary}
There exists $\epsilon >0$, $\alpha > 0$ such that both of the following hold for all $m \in \{3,4,5\}$:
\begin{enumerate}
\item If $G$ is a planar graph have girth at least $m$ then $G$ has at least $2^{\epsilon v(G)}$ distinct $(8-m)$-colorings.
\item If $G$ embeds on a surface $S$, has girth at least $m$, and is $(8-m)$-colorable then $G$ has  at least $2^{\epsilon v(G) - \alpha g(S)}$ distinct $(8-m)$-colorings.
\end{enumerate}
\end{corollary}
\begin{proof}
\paragraph{}
Choose parameters
$$\epsilon = \frac{(7-m)(m-2) - m}{(m-2){(8-m) \choose 2}}$$
and
$$\alpha = \frac{m}{(m-2){(8-m) \choose 2}}$$
It is not hard to see for $m \in \{3,4,5\}$ both $\epsilon$ and $\alpha$ are strictly greater than $0$.
\paragraph{}
By Grotzsch's Theorem, planar graphs of girth $m$ are $(8-m)$-colorable for $m \in \{3,4,5\}$. Further $g(S) = 0$ if $S$ is the plane $S_0$. So it will suffice to prove the second claim of the Corollary. Let $G$ be a graph which embeds on a surface $S$, has girth at least $m$, and is $(8-m)$-colorable. From the previous Lemma, $G$ has at least
$$2^{\frac{(7-m)v(G) - e(G)}{{(8-m)\choose 2}}}$$
distinct $(8-m)$-colorings. Since each edge is incident with $2$ faces and each face contains at least $m$ edges we have
$$f(G) \leq \frac{2}{m}e(G)$$
Applying Euler's formula for general surfaces
$$ v(G) - e(G) + f(G) = 2- g(S)$$
to the left hand side of the above inequality, we see that
$$ e(G) - v(G) + 2-g(S) \leq \frac{2}{m}e(G).$$
Simplifying we observe that
$$e(G) \leq \frac{m}{m-2}(v(G) - 2 + g(S))$$
Therefore we have that
\begin{align*}
(7-m)v(G) - e(G) &\geq (7-m)v(G) -\frac{m}{m-2}(v(G) - 2 + g(S))\\
&= \frac{(7-m)(m-2) - m}{m-2}v(G) + \frac{m}{m-2} (2-g(S)) \\
&\geq \frac{(7-m)(m-2) - m}{m-2}v(G) - \frac{m}{m-2} (g(S))
\end{align*}
Therefore
$$\frac{(7-m)v(G) - e(G)}{{(8-m)\choose 2}} \geq \epsilon v(G) - \alpha g(S)$$
and hence $G$ has at least
$$2^{\epsilon v(G) - \alpha g(S)}$$
distinct colorings, as desired.
\end{proof}
\section{}
\paragraph{}
We may use the following theorems.
\begin{theorem}\label{th:g-e-choosable}
	If $G$ is a graph and $e\in E(G)$ such that $G-e$ is planar then $G$ is $5$-list-colorable.
\end{theorem}
\begin{theorem}\label{th:closeness}
	There exists $r>0$ such that the following holds:
	
	Let $G$ be a connected plane graph with $S\subseteq V(G)$ such that $G$ is $S$-critical with respect to some $5$-list-assignment $L$. If $S$ has at least two components then there exists two distinct components $S_1,S_2$ of $S$ such that
	$$d(S_1,S_2) \leq r(|V(S_1)| + |V(S_2)|).$$
\end{theorem}
\paragraph{}
We will prove the following theorem
\begin{theorem}
	There exists $d>0$ such that the following holds:
	
	Let $G$ be a graph and $F \subset E(G)$ such that $G-F$ is planar. If for every two distinct edges $e_1, e_2 \in F$ we have $d(e_1, e_2) \geq d$ then $G$ is $5$-list-colorable.
\end{theorem}
\begin{proof}
Choose $d = 4r^2+2r+1$ where $r$ is as in Theorem \ref{th:closeness}.
\paragraph{}
Suppose the theorem is false. Let $(G,F,L)$ be a minimal counterexample with respect to $|V(G)| + |E(G)| + |F|$. Here $L$ denotes a $5$-list-assignment.
\paragraph{}
Label the elements of $F$ as $\{e_1=u_1v_1, \dots, e_k = u_kv_k\}$. For each $e_i \in F$ let $P_i$ be a $u_i-v_i$ path of length at most $2r$ in $G-F$, provided such a path exists, and let $P_i$ be the empty graph otherwise. Let $S\subset G$ be the graph consisting of $V(F)$ and $\bigcup_{i=1}^k P_i$.
\paragraph{}
Hence we claim $S$ consists of a disjoint union of path components $P_i$ for $i \in \{1,\dots, k\}$ as well as disjoint vertex components $u_j$, $v_j$ where there is no $u_j-v_j$ path of length at most $2r$ in $G-F$. To see this, suppose $P_i$ and $P_j$ intersect at a vertex $x$ for $i\neq j$. Without loss of generality say $d(u_i,x) \leq d(v_i,x)$ and $d(u_j, x) \leq d(v_j, x)$. Then $d(u_i, x) \leq r$ and $d(u_j,x) \leq r$. So we have
$$d(u,i,u,j) \leq r + r = 2r < d$$
a contradiction. The argument follows similarly if a disjoint vertex component intersects a path component.
\paragraph{}
Now we claim that $S$ has at least two components. By our previous argument it suffices to show $|F| \geq 2$. Indeed by Theorem \ref{th:g-e-choosable} if $|F| \leq 1$ then $G$ is $5$-list-colorable, a contradiction.
\paragraph{}
Now we claim $G$ is $S$-critical. Let $H$ be a proper subgraph of $G$ containing $S$. By minimality of $G$, since $H-F$ is planar, and the distances between vertices in $H$ is at least their distance in $G$, $H$ is $5$-list-colorable. Let $\phi$ be a $5$-list-coloring of $H$. If $\phi$ extends to $G$ then $G$ is $5$-list-colorable, a contradiction. Hence $\phi$ does not extend. Thus $G$ is $S$-critical.
\paragraph{}
In order to apply Theorem \ref{th:closeness} with $G-F$ and $S$ it remains to verify $G-F$ is connected. Suppose $G-F$ is disconnected. Then there exist  $u_i,v_i \in F$ such that $u_i$ and $v_i$ lie in distinct components of $G-F$. Re-embed on the plane, if necessary, the components of $G-F$ containing $u_i$ and $v_i$ so $u_i$ and $v_i$ lie incident to the outer face. Then join $u_i$ and $v_i$ by their edge $e_i$ drawn as a curve in the outer face. Hence $G - (F\backslash \{e_i\})$ is planar. But then $(G, F\backslash\{e_i\})$ is a smaller counterexample than $(G,F)$ contradicting minimality.
\paragraph{}
By Theorem \ref{th:closeness} there exist distinct components $S_1$ and $S_2$ such that there is in $G-F$ is
$$d(S_1,S_2) \leq r(|V(S_1)| + |V(S_2)|).$$
First consider the case that $S_1 = u_i$ and $S_2=v_j$ are single vertex components. Then we have
$$d(u,v) \leq r(1+1) = 2r.$$
So if $i=j$ this contradicts that $u$ and $v$ are not joined by a path in $S$, and if $i\neq j$ this contradicts that
$$d(e_i,e_j) \geq d > 2r.$$
Now consider the case that $S_1 =P_i$ and $S_2 = P_j$ are path components. Then there exist $x_i$ on $P_i$ and $x_j$ on $P_j$ such that
$$d(x_i, x_j) \leq r(|V(S_1)| + |V(S_2)|) \leq r(2r + 2r) = 4r^2.$$
Without loss of generality say $d(u_i,x_i) \leq d(v_i,x_i)$ and $d(u_j, x_i) \leq d(v_j, x_i)$. Then $d(u_i, x_i) \leq r$ and $d(u_j,x_i) \leq r$. So we have
$$d(u_i,u_j) \leq r + 4r^2 + r = 4r^2 + 2r < d$$
contradicting that $d(e_i,e_j) \geq d.$ The argument where $S_1$ is a path component and $S_2$ is a vertex component follows similarly.
\paragraph{}
Therefore in any case we obtain a contradiction, as desired.
\end{proof}

\section{}
We may use the following theorem.
\begin{theorem}\label{th:def}
	There exists $c>0$ such that the following holds:
	
	Let $G$ be a plane graph, let $S$ be a connected subgraph of $G$, and let $L$ be a $5$-list-assignment for $G$. If $G$ is $S$-critical with respect to $L$ then
	$$v(G|S) \leq c(\defi(G|S) - 1),$$
	where $\defi(G|S) = e(G|S) - 3v(G|S).$
\end{theorem}
We will prove the following lemma, under the assumption that a minimum counterexample $G$ has a vertex in $V(G)\backslash V(S)$ with at least three neighbours in $S$.
\begin{lemma}
	Let $G$ be a plane graph with connected subgraph $S$ and let $L$ be a $5$-list-assignment for $G$. If $\phi$ is an $L$-coloring of $S$ that extends to an $L$-coloring of $G$ then
	$$\log_2 E(\phi) \geq (v(G|S) - (c+1)\defi(G|S))/9,$$
	where $E(\phi)$ is the number of extensions of $\phi$ to $G$ and $c$ is the constant of Theorem \ref{th:def}.
\end{lemma}
\begin{proof}
	Suppose not. Let $(G,S,L, \phi)$ be a minimum counterexample, minimizing $v(G|S)$. We may assume $G$ has a vertex $v$ in $V(G)\backslash V(S)$ with at least three neighbours in $S$. Let $H = S+v$. 
	\paragraph{}
	We first consider the case that $v(G|S) = 1$, i.e. $G = S + v$.
	\begin{align*}
	\frac{v(G|S) - (c+1)\defi(G|S)}{9} &= \frac{1 - (c+1)e(G|S) +3(c+1)}{9} \\
	&\begin{cases}
		=\frac{1}{9}, &\text{if $|N(v)\cap v(S)| = 3$}  \\
		\leq\frac{1-(c+1)}{9} <0, &\text{if $|N(v) \cap V(S)| \geq 4$}	\end{cases}
	\end{align*}
	Since $\phi$ has at least one extension to $G$ if $|N(v) \cap V(S)| \geq 4$ and $\log_2(1) = 0$, and $\phi$ has at least two extensions to $G$ if $|N(v) \cap V(S)| = 3$ (as at least two colors in $v$'s list are not used at neighbours) and $\log_2(2) = 1 > \frac{1}{9}$, the desired bound holds.
	\paragraph{}
	Therefore we may assume that $v(G|S) \geq 2$. Consider the case that $|N(v) \cap V(S)| \geq 4$. Let $\phi'$ be an extension of $\phi$ to $G$, restricted to $H$. Then $\phi'$ is an $L$-coloring of $H$ which extends to $G$. By minimality, 
	$$\log_2 E(\phi') \geq \frac{v(G|H) - (c+1)\defi(G|H)}{9}$$
	Now $v(G|H) = v(G|S) - 1$. So we see that
	\begin{align*}
	\frac{v(G|H) - (c+1)\defi(G|H)}{9} &= \frac{v(G|S) - 1 -(c+1)\defi(G|S) +(c+1)|N(v)\cap V(S)| - 3(c+1)}{9} \\
	&\geq \frac{v(G|S) - 1 -(c+1)\defi(G|S) +(c+1)4 - 3(c+1)}{9}\\
	&\geq \frac{v(G|S) -(c+1)\defi(G|S)}{9}.
	\end{align*}
	Hence since $E(\phi) \geq E(\phi')$ this yields the desired bound.
	\paragraph{}
	Thus we may assume that $|N(v) \cap V(S)| = 3$. Yet again we distinguish cases. First suppose there exists $\phi_1$ and $\phi_2$ distinct $L$-colorings of $H$, extended from $\phi$, which extend to $G$. Without loss of generality suppose $E(\phi_1) \leq E(\phi_2)$. Then, using minimality,
	\begin{align*}
	\log_2E(\phi) &\geq \log_2(E(\phi_1) + E(\phi_2)) \\
	&\geq \log_2(2E(\phi_1))\\
	&= 1 + \log_2(E(\phi_1))\\
	&\geq 1+ \frac{v(G|H) - (c+1)\defi(G|H)}{9}\\
	&= 1 + \frac{v(G|S) - 1 -(c+1)\defi(G|S) +(c+1)|N(v)\cap V(S)| - 3(c+1)}{9}\\
	&= 1 + \frac{v(G|S) -(c+1)\defi(G|S)}{9} + \frac{-1}{9} \\
	&\geq \frac{v(G|S) -(c+1)\defi(G|S)}{9}.
	\end{align*}
	Thus yielding the desired bound.
	\paragraph{}
	Therefore, finally, we suppose without loss of generality $\phi_1$ and $\phi_2$ are distinct $L$-colorings of $H$ and $\phi_1$ extends to $G$, but $\phi_2$ does not. This is last case to consider as at least one $L$-coloring of $H$ must extend to $G$ as $\phi$ does.
	\paragraph{}
	Let $G' \subseteq G$ be a subgraph of $G$ that is $H$-critical with respect to $\phi_2$. Such $G'$ exists since $\phi_2$ does not extend to $G$. By Theorem \ref{th:def} $$v(G'|H) \leq c(\defi(G'|H) -1).$$
	Let $\phi'$ now denote the restriction of an extension of $\phi$ to $G$ to $G'$. That is, $\phi'$ is an $L$-coloring of $G'$ that extends to $G$. So by minimality
	$$\log_2(E(\phi')) \geq \frac{v(G|G') - (c+1)\defi(G|G')}{9}.$$
	It is easy to see that $v(\cdot)$ and $\defi(\cdot)$ satisfy the ``chain rule", that is
	\begin{equation}\label{chain-rule}
	\defi(G|H) = \defi(G|G') + \defi(G'|H)
	\end{equation}
	and
	\begin{equation}\label{vgs-eq}
		v(G|S) - 1 = v(G|H) = v(G|G') + v(G'|H).
	\end{equation}
	We make one final observation before the final bound
	\begin{equation}\label{defi-eq}
	\defi(G|H) = \defi(G|S) |N(v)\cap V(S)| -3 = \defi(G|S) 
	\end{equation}
	Now we see that
	\begin{align*}
	\log_2E(\phi) &\geq \log_2E(\phi')\\
	&\geq \frac{v(G|G') - (c+1)\defi(G|G')}{9} \\
	&= \frac{v(G|S) -1 -v(G'|H) -(c+1)\defi(G|H) + (c+1)\defi(G'|H)}{9} &\text{by (\ref{chain-rule}) and (\ref{vgs-eq})}\\
	&=\frac{v(G|S) -1 -v(G'|H) -(c+1)\defi(G|S) + (c+1)\defi(G'|H)}{9} &\text{ by (\ref{defi-eq})}\\
	&\geq \frac{v(G|S) -(c+1)\defi(G|S) +\defi(G'|H) + c - 1}{9} &\text{ by Theorem \ref{th:def}}\\
	&\geq \frac{v(G|S) -(c+1)\defi(G|S) +v(G'|H)/c + 1 + c - 1}{9} &\text{ by Theorem \ref{th:def}}\\
	&\geq \frac{v(G|S) -(c+1)\defi(G|S)}{9},
	\end{align*}
	as desired.
\end{proof}

\section{}
\paragraph{}
We may use the following theorem.
\begin{theorem}\label{th:four}
	There exists $\delta_0 >0$ such that for every $\delta \in (0,\delta_0]$, there exists $\epsilon \in (0,\delta)$ such that if $G$ is a $4$-critical graph then
	$$e(G) \geq \frac{(5+\epsilon)v(G) - 2 - \delta T(G)}{3},$$
	where $T(G)$ is the maximum number of vertex disjoint $\leq 4$-cycles in $G$.
\end{theorem}
We will probve the following theorem.
\begin{theorem}
	There exists $c>0$ such that the following holds:
	
	Let $G$ be a planar graph having girth at least five and let $S$ be a subgraph of $G$. If $G$ is $S$-critical for $3$-coloring then $|V(G)| \leq c|V(S)|$.
\end{theorem}
\begin{proof}
	For $\delta_0$ as in Theorem \ref{th:four}, choose $\delta = \min\{\delta_0, \frac{1}{3}\}$, and let $\epsilon$ be the corresponding value in Theorem \ref{th:four}. Choose $c = (1+\frac{5}{\epsilon}) > 0$. Define for any graph $G$
	$$d(G) = 3e(G) - (5+\epsilon)v(G)$$
	and $d(G|S) = d(G) - d(S)$ for subgraph $S$ of $G$. Similar to the previous problem, it's clear that $d(G|S)$ satisfies the ``chain rule", that is if $S\subseteq H \subseteq G$ then
	$$d(G|S) = d(G|H) + d(H|S).$$
	\paragraph{Main Claim}
	We claim for any $G$ and $S$ as in the statement of the Theorem, $d(G|S) \geq 0$.
	\paragraph{}
	Suppose for a contradiction this claim is false. Let $(G,S)$ be a counterexample minimizing $v(G|S)$. That is $G$ is a girth at least $5$ planar graph and $G$ is $S$-critical for $3$-coloring. By minimiamlity, $G$ is connected.
	\paragraph{}
	$G$ has at least two vertices not in $S$ or at least $3$ edges not in $S$ (otherwise, it is easy to extend any $3$-coloring of $S$ to $G$). Let $\phi$ be a $3$-coloring of $S$ which extends to a strict supergraph of $S$ but not to $G$. Let $H$ be the smallest subgraph of $G$ containing $S$ such that $\phi$ does not extend to $H$. So $H$ contains $S$ as a strict subgraph.
	\paragraph{}
	We proceed by case distinction. Either $H=G$ or $H\subset G$. We first consider the case $H \subset G$. By minimality of $H$, every strict subgraph of $H$ can be colored by an extension of $\phi$. hence $H$ is $S$-critical. Since $H$ contains $S$, $G$ is $H$-critical. So by minimality, neither $(G,H)$ nor $(H,S)$ are counterexamples to the main claim. Thus we observe
	$$d(G|S) = d(G|H) + d(H|S) \geq 0 + 0 = 0,$$
	as desired.
	\paragraph{}
	The more complex case is when $H=G$. In this case we see $G$ is $\phi$-critical as the minimality of our choice of $H$ implies every strict subgraph of $G$ containing $S$ is colorable with an extension of $\phi$. Let $G_S[\phi]$ denote the graph obtained from $G$ by identifying vertices of $S$ according to their color class with respect to $\phi$. Let $x_1, x_2, x_k$, $k\leq 3$, be vertices of $G_S[\phi]$ corresponding to the respective color classes of $\phi(S)$. If necessary we add edges between each $x_i, x_j$ so they form a complete subgraph.
	\paragraph{}
	Now we claim $G_S[\phi]$ is not $3$-colorable. Otherwise we can permute a $3$-coloring of $G_S[\phi]$ so it assigns color $i$ to each $x_i$. This coloring then corresponds to an extension of $\phi$ which $3$-colors $G$ (by assigning $i$ each vertex of $G$ in $x_i$). Hence $G_S[\phi]$ contains a $4$-critical subgraph $W$. Let $S' = S \cup W - X$, where $X = W \cap \{x_1, \dots, x_k\}$.
	\paragraph{}
	We claim $W$ contains $G_S[\phi] - X$. Otherwise we can extend $\phi$ to a $3$-coloring of $W$. Therefore $S' = G$. Now if we define a potential function $p(G) = -d(G)$ we can apply the Potential Extension Lemma to see
	$$p(G) = p(S') \leq p(S) + p(W) - p(X)$$
	But then rearranging we see that
	$$d(G|S) \geq p(X) + d(W).$$
	Computing the potential of $X$ we see that either $p(X) = 5+\epsilon$, $p(X) = 7 + 2\epsilon$, or $p(X) = 6+3\epsilon$ depending on whether $|X| = 1, 2,$ or $3$ respectively. So $p(X) \geq 5+\epsilon$.
	\paragraph{}
	Applying Theorem \ref{th:four} to $4$-critical graph $W$ we see that
	$$d(W) \geq -2 - \delta T(W)$$
	Since $G$ is girth $5$, $T(W) \leq 3$ as the only cycles of length smaller than $5$ in $W$ intersect $\{x_1,\dots, x_k\}$ so there are at most $3$ vertex-disjoint such cycles. Hence
	$$d(W) \geq -2 - 3\delta.$$
	Thus substituting our lower bounds on $d(W)$ and $p(X)$ into the bound for $d(G|S)$ we see that
	$$d(G|S) \geq 5+\epsilon -2-3\delta \geq 1 - 3\delta \geq 0$$
	where the last inequality follows since $\delta \leq \frac{1}{3}$.
	\paragraph{Finishing the proof}
	Suppose that $G$ is a girth at least $5$ planar graph and $G$ is $S$-critical for $3$-coloring. Now we can use the Claim that $d(G|S) \geq 0$ to achieve the desired bound $|V(G)| \leq c|V(S)|$. Observe that
	$$0 \leq d(G|S) = 3e(G|S) -5v(G|S) -\epsilon v(G|S)$$
	Since $G$ is planar, girth at least $5$ we have $3e(G) -5v(G) \leq -10$. Substituting into the above yields
	$$0 \leq -10 -3e(S) +5v(S) - \epsilon v(G|S).$$ Therefore
	$$\epsilon v(G|S) \leq 5v(S)$$
	and so 
	$$v(G) \leq (1+\frac{5}{\epsilon}) v(S) = c v(S),$$
	as desired.
	\end{proof}
\end{document}
